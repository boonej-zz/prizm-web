extends ../layouts/layout_app

block head
  script(src='/javascripts/profile/profile_activity.js' type='text/javascript')
  link(rel='stylesheet' href='/stylesheets/profile/profile_activity.css')

block content
  .container.topnav-offset
    .row
      .activity-header.col-sm-10.col-sm-offset-1
        | Activity 
    .row
      .col-sm-10.col-sm-offset-1
          ul.nav.nav-tabs.nav-justified(role='tablist' id='activity-tab')
            li(role='presentation' class='active')
              a(href='#'
                data-toggle='tab'
                onclick='activity.notificationTab()')
                | Notifications
            li(role='presentation' class='')
              a(href='#'
                data-toggle='tab'
                onclick='activity.requestTab()')
                | Requests
    .row
      #notifications
        .col-sm-10.col-sm-offset-1.background-column
          table.table.notifications
            tbody
              each notification in notifications
                tr
                  td
                    if notification.from
                      if notification.from.profile_photo_url
                        img(src='https://#{notification.from.profile_photo_url.substr(7)}'
                            class='prizm-avatar-sm cursor' 
                            onclick='prizm.showProfile("#{notification.from._id}")')
                      else
                        img(src='/images/default-profile.png' 
                            class='prizm-avatar-sm cursor'
                            onclick='prizm.showProfile("#{notification.from._id}")')
                  td
                    if notification.from
                      .activity-name.cursor(onclick='prizm.showProfile("#{notification.from._id}")')
                        | #{notification.from.name}
                  td
                    .activity-action(class='#{notification.action}')
                      if notification.action == 'like'
                        | Liked your post.
                      if notification.action == 'insight'
                        | Sent you an insight.
                      if notification.action == 'follow'
                        | Started following you.
                      if notification.action == 'comment'
                        | Commented on your post.
                      if notification.action == 'group_approved'
                        | Approved your membership request.
                  td
                    .activity-time
                      | #{notification.time_since} ago
                  td
                    if notification.photo_url
                      img(src='https://#{notification.photo_url.substr(7)}'
                          class='activity-photo')
      #requests
        .col-sm-10.col-sm-offset-1.background-column
          table.table
            tbody
              each request in requests
                tr
                  td
                    if request.to && String(request.to._id) != String(currentUser._id)
                      if request.to.profile_photo_url
                        img(src='https://#{request.to.profile_photo_url.substr(7)}'
                            class='prizm-avatar-sm cursor' 
                            onclick='prizm.showProfile("#{request.to._id}")')
                      else
                        img(src='/images/default-profile.png' 
                            class='prizm-avatar-sm cursor'
                            onclick='prizm.showProfile("#{request.to._id}")')
                    if request.from && String(request.from._id) != String(currentUser._id)
                      if request.from.profile_photo_url
                        img(src='https://#{request.from.profile_photo_url.substr(7)}'
                            class='prizm-avatar-sm cursor' 
                            onclick='prizm.showProfile("#{request.from._id}")')
                      else
                        img(src='/images/default-profile.png' 
                            class='prizm-avatar-sm cursor'
                            onclick='prizm.showProfile("#{request.from._id}")')
                  td
                    if request.to && String(request.to._id) != String(currentUser._id)
                      .activity-name.cursor(onclick='prizm.showProfile("#{request.to._id}")')
                        | #{request.to.name}
                    if request.from && String(request.from._id) != String(currentUser._id)
                      .activity-name.cursor(onclick='prizm.showProfile("#{request.from._id}")')
                        | #{request.from.name}
                  td
                    .activity-status(class='#{request.status}')
                      if request.to && String(request.to._id) != String(currentUser._id)
                        if request.status == 'accepted'
                          | Has accepted your trust request
                        else 
                          | has recieved your trust request
                      if request.from && String(request.from._id) != String(currentUser._id)
                        if request.status == 'accepted'
                          | Was added to your trust
                        else
                          | has requested your trust
                  td
                    .activity-time
                      | #{request.time_since} ago
                  td(data-trust-id='#{request._id}')
                      if request.from && String(request.from._id) != String(currentUser._id)
                        if request.status == 'accepted'
                          .activity-action.accepted
                        if request.status == 'pending'
                          .activity-action.accept(onclick='activity.acceptRequest(event)')
                          .activity-action.deny(onclick='activity.denyRequest(event)')
